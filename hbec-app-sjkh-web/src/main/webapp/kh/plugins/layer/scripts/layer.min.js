define(function(b,a,c){!function(h,g){var l,k,j,i={iE6:!-[1]&&!h.XMLHttpRequest,times:0};i.getPath=function(){var e=document.scripts||l("script"),d=e[e.length-1].src;return d.substring(0,d.lastIndexOf("/")+1)},i.load=function(){b("../css/layer.css");var d=b("gconfig").layerTheme;"default"!=d&&b.async("../css/theme/"+d+".css",function(){})},this.layer={v:"1.6.0",ready:function(e){var d="#layerCss";return l(d).ready(function(){e()})},alert:function(m,f,o,n){return l.layer({dialog:{msg:m,type:f,yes:n},title:o,area:["auto","auto"]})},confirm:function(m,f,o,n){return l.layer({dialog:{msg:m,type:4,btns:2,yes:f,no:n},title:o})},msg:function(m,p,o,n){return(""==m||m==g)&&(m="&nbsp;"),p===g&&(p=2),l.layer({dialog:{msg:m,type:o},time:p,title:["",!1],closeBtn:["",!1],end:function(){n&&n()}})},tips:function(n,m,r,q,p,o){return l.layer({type:4,shade:!1,time:r,maxWidth:q,tips:{msg:n,guide:p,follow:m,style:o}})},load:function(m,f,o){var n=!0;return 3===f&&(n=!1),l.layer({time:m,shade:o,loading:{type:f},border:[10,0.3,"#000",n],type:3,title:["",!1],closeBtn:[0,!1]})}},j=function(e){i.times++,this.index=i.times;var d=this.config;this.config=l.extend({},d,e),this.config.dialog=l.extend({},d.dialog,e.dialog),this.config.page=l.extend({},d.page,e.page),this.config.iframe=l.extend({},d.iframe,e.iframe),this.config.loading=l.extend({},d.loading,e.loading),this.config.tips=l.extend({},d.tips,e.tips),this.creat()},j.pt=j.prototype,j.pt.config={type:0,shade:[0.3,"#000",!0],shadeClose:!1,fix:!0,move:[".xubox_title",!0],moveOut:!1,title:["信息",!0],offset:["200px","50%"],area:["310px","auto"],closeBtn:[0,!0],time:0,bgcolor:"#fff",border:[8,0.3,"#000",!0],zIndex:19891014,maxWidth:400,dialog:{btns:1,btn:["确定","取消"],type:3,msg:"",yes:function(d){layer.close(d)},no:function(d){layer.close(d)}},page:{dom:"#xulayer",html:"",url:""},iframe:{src:"http://sentsin.com"},loading:{type:0},tips:{msg:"",follow:"",guide:0,isGuide:!0,style:["background-color:#FF9900; color:#fff;","#FF9900"]},success:function(){},close:function(d){layer.close(d)},end:function(){}},j.pt.type=["dialog","page","iframe","loading","tips"],j.pt.space=function(D){var C,B,A,z,y,x,w,v,u,t,s,r,q,p;return D=D||"",C=this.index,B=this.config,A=B.dialog,z=this.dom,y=-1===A.type?"":'<span class="xubox_msg xulayer_png32 xubox_msgico xubox_msgtype'+A.type+'"></span>',x=['<div class="xubox_dialog">'+y+'<span class="xubox_msg xubox_text" style="'+(y?"":"padding-left:20px")+'">'+A.msg+"</span></div>",'<div class="xubox_page">'+D+"</div>",'<iframe allowtransparency="true" id="'+z.ifr+C+'" name="'+z.ifr+C+'" onload="$(this).removeClass(\'xubox_load\');" class="'+z.ifr+'" frameborder="0" src="'+B.iframe.src+'"></iframe>','<span class="xubox_loading xubox_loading_'+B.loading.type+'"></span>','<div class="xubox_tips" style="'+B.tips.style[0]+'"><div class="xubox_tipsMsg">'+B.tips.msg+'</div><i class="layerTipsG"></i></div>'],w="",v="",u=B.zIndex+C,t="z-index:"+u+"; background-color:"+B.shade[1]+"; opacity:"+B.shade[0]+"; filter:alpha(opacity="+100*B.shade[0]+");",B.shade[2]&&(w='<div times="'+C+'" id="xubox_shade'+C+'" class="xubox_shade" style="'+t+'"></div>'),B.zIndex=u,s="",r="",q="z-index:"+(u-1)+";  background-color: "+B.border[2]+"; opacity:"+B.border[1]+"; filter:alpha(opacity="+100*B.border[1]+"); top:-"+B.border[0]+"px; left:-"+B.border[0]+"px;",B.border[3]&&(v='<div id="xubox_border'+C+'" class="xubox_border" style="'+q+'"></div>'),B.closeBtn[1]&&(r='<a class="xubox_close xulayer_png32 xubox_close'+B.closeBtn[0]+'" href="javascript:;"></a>'),B.title[1]&&(s='<h2 class="xubox_title"><em>'+B.title[0]+"</em></h2>"),p='<div times="'+C+'" showtime="'+B.time+'" style="z-index:'+u+'" id="'+z.lay+C+'" class="'+z.lay+'"><div style="background-color:'+B.bgcolor+"; z-index:"+u+'" class="xubox_main">'+x[B.type]+s+r+'<span class="xubox_botton"></span></div>'+v+"</div>",[w,p]},j.pt.dom={lay:"xubox_layer",ifr:"xubox_iframe"},j.pt.creat=function(){var y,x,w,v,u,t,s=this,r="",q=this.config,p=q.dialog,f=s.config.title,d=s.dom;switch(f.constructor===Array||(s.config.title=[f,!0]),f===!1&&(s.config.title=[f,!1]),y=q.page,x=l("body"),w=function(e){var e=e||"";r=s.space(e),x.append(r[0])},q.type){case 1:if(""!==y.html){w('<div class="xuboxPageHtml">'+y.html+"</div>"),x.append(r[1])}else{if(""!==y.url){w('<div class="xuboxPageHtml" id="xuboxPageHtml'+s.index+'">'+y.html+"</div>"),x.append(r[1]),l.get(y.url,function(e){l("#xuboxPageHtml"+s.index).html(e),y.ok&&y.ok(e)})}else{if(0!=l(y.dom).parents(".xubox_page").length){return}w(),l(y.dom).show().wrap(r[1])}}break;case 2:w(),x.append(r[1]);break;case 3:q.title=["",!1],q.area=["auto","auto"],q.closeBtn=["",!1],l(".xubox_loading")[0]&&layer.close(l(".xubox_loading").parents("."+d.lay).attr("times")),w(),x.append(r[1]);break;case 4:q.title=["",!1],q.area=["auto","auto"],q.fix=!1,q.border=!1,l(".xubox_tips")[0]&&layer.close(l(".xubox_tips").parents("."+d.lay).attr("times")),w(),x.append(r[1]),l("#"+d.lay+i.times).find(".xubox_close").css({top:5,right:5});break;default:q.title[1]||(q.area=["auto","auto"]),l(".xubox_dialog")[0]&&layer.close(l(".xubox_dialog").parents("."+d.lay).attr("times")),w(),x.append(r[1])}if(v=i.times,this.layerS=l("#xubox_shade"+v),this.layerB=l("#xubox_border"+v),this.layerE=l("#"+d.lay+v),u=this.layerE,this.layerMian=u.find(".xubox_main"),this.layerTitle=u.find(".xubox_title"),this.layerText=u.find(".xubox_text"),this.layerPage=u.find(".xubox_page"),this.layerBtn=u.find(".xubox_botton"),t=-1!=q.offset[1].indexOf("px")?parseInt(q.offset[1]):"50%"==q.offset[1]?q.offset[1]:parseInt(q.offset[1])/100*k.width(),u.css({left:t+q.border[0],width:q.area[0],height:q.area[1]}),q.fix?u.css({top:parseInt(q.offset[0])+q.border[0]}):u.css({top:parseInt(q.offset[0])+k.scrollTop()+q.border[0],position:"absolute"}),0==q.type&&q.title[1]){switch(p.btns){case 0:s.layerBtn.html("").hide();break;case 2:s.layerBtn.html('<a href="javascript:;" class="xubox_yes xubox_botton2">'+p.btn[0]+'</a><a href="javascript:;" class="xubox_no xubox_botton3">'+p.btn[1]+"</a>");break;default:s.layerBtn.html('<a href="javascript:;" class="xubox_yes xubox_botton1">'+p.btn[0]+"</a>")}}"auto"===u.css("left")?(u.hide(),setTimeout(function(){u.show(),s.set(v)},500)):s.set(v),q.time<=0||s.autoclose(),this.callback()},j.pt.set=function(K){var J,I,H,G,F,E,D,C,B,A,z,y,x=this,w=this.layerE,v=this.config,f=(v.dialog,v.page),d=x.dom;switch(x.autoArea(K),v.title[1]?i.iE6&&x.layerTitle.css({width:w.outerWidth()}):4!=v.type&&w.find(".xubox_close").addClass("xubox_close1"),w.attr({type:x.type[v.type]}),v.type){case 1:w.find(f.dom).addClass("layer_pageContent"),v.shade[2]&&w.css({zIndex:v.zIndex+1}),v.title[1]&&x.layerPage.css({top:x.layerTitle.outerHeight()});break;case 2:J=w.find("."+d.ifr),I=w.height(),J.addClass("xubox_load").css({width:w.width()}),v.title[1]?J.css({top:x.layerTitle.height(),height:I-x.layerTitle.height()}):J.css({top:0,height:I}),i.iE6&&J.attr("src",v.iframe.src);break;case 4:H=l(v.tips.follow),G=H.offset().top,F=G-w.outerHeight(),E=H.offset().left,D=E,C=v.tips.style[1],B=w.outerHeight(),A=w.outerWidth(),z=w.find(".layerTipsG"),A>v.maxWidth&&w.width(v.maxWidth),1===v.tips.guide?(y=k.width()-D-A-w.outerWidth()-10,F=G,y>0?(D=D+H.outerWidth()+10,z.removeClass("layerTipsL").addClass("layerTipsR").css({"border-right-color":C})):(D=D-w.outerWidth()-10,z.removeClass("layerTipsR").addClass("layerTipsL").css({"border-left-color":C}))):F-k.scrollTop()-12<=0?(F=G+B+10,z.removeClass("layerTipsT").addClass("layerTipsB").css({"border-bottom-color":C})):(F-=10,z.removeClass("layerTipsB").addClass("layerTipsT").css({"border-top-color":C})),v.tips.isGuide||z.remove(),w.css({top:F,left:D});break;default:this.layerMian.css({"background-color":"#fff"}),v.title[1]?this.layerText.css({paddingTop:18+x.layerTitle.outerHeight()}):(w.find(".xubox_msgico").css({top:"10px"}),x.layerText.css({marginTop:12}))}this.move()},j.pt.autoArea=function(){var C,B,A,z,y,x=this,w=x.layerE,v=x.config,u=v.page,t=x.layerMian,s=x.layerBtn,r=x.layerText,q=x.layerPage,f=x.layerB;switch("auto"===v.area[0]&&t.outerWidth()>=v.maxWidth&&w.css({width:v.maxWidth}),C=v.title[1]?x.layerTitle.innerHeight():0,v.type){case 0:B=s.find("a"),A=r.outerHeight()+20,z=B.length>0?B.outerHeight()+20:0;break;case 1:z=0,A=l(u.dom).outerHeight(),"auto"===v.area[0]&&w.css({width:q.outerWidth()}),""!==u.html&&(A=q.outerHeight());break;case 3:y=l(".xubox_loading"),z=0,A=y.outerHeight(),t.css({width:y.width()})}"auto"===v.area[1]&&t.css({height:C+A+z}),f.css({width:w.outerWidth()+2*v.border[0],height:w.outerHeight()+2*v.border[0]}),i.iE6&&"auto"!=v.area[0]&&t.css({width:w.outerWidth()}),"50%"!==v.offset[1]&&""!=v.offset[1]||4===v.type?w.css({marginLeft:0}):w.css({marginLeft:-w.outerWidth()/2})},j.pt.move=function(){var w,v,u,t,s,r=this,q=this.config,p=r.layerE.find(q.move[0]),o=r.dom,n=0,d=0;q.move[1]&&p.attr("move","ok"),q.move[1]?r.layerE.find(q.move[0]).css({cursor:"move"}):r.layerE.find(q.move[0]).css({cursor:"auto"}),l(q.move[0]).on("mousedown",function(m){if(m.preventDefault(),"ok"===l(this).attr("move")){v=!0,w=l(this).parents("."+o.lay);var f=w.offset().left,e=w.offset().top,y=w.width()-6,x=w.height()-6;l("#xubox_moves")[0]||l("body").append('<div id="xubox_moves" class="xubox_moves" style="left:'+f+"px; top:"+e+"px; width:"+y+"px; height:"+x+'px; z-index:2147483584"></div>'),s=l("#xubox_moves"),u=m.pageX-s.position().left,t=m.pageY-s.position().top,n=k.scrollLeft(),"fixed"!==w.css("position")||(d=k.scrollTop())}}),l(document).mousemove(function(A){var z,y,x,f,e;v&&(A.preventDefault(),z=A.pageX-u,y="fixed"===w.css("position")?A.pageY-t:A.pageY-t,q.moveOut||(x=k.width()-s.outerWidth()-q.border[0],f=k.scrollTop(),e=q.border[0]+f,z<q.border[0]&&(z=q.border[0]),z>x&&(z=x),e>y&&(y=e),y>k.height()-s.outerHeight()-q.border[0]+f&&(y=k.height()-s.outerHeight()-q.border[0]+f)),s.css({left:z,top:y}))}).mouseup(function(){var f;try{v&&(f=0==parseInt(w.css("margin-left"))?parseInt(s.css("left")):parseInt(s.css("left"))+-parseInt(w.css("margin-left")),"fixed"===w.css("position")||(f-=w.parent().offset().left),w.css({left:f,top:parseInt(s.css("top"))-d}),s.remove()),v=!1}catch(e){v=!1}q.moveEnd&&q.moveEnd()})},j.pt.autoclose=function(){var e=this,d=this.config.time,f=function(){d--,0===d&&(layer.close(e.index),clearInterval(e.autotime))};this.autotime=setInterval(f,1000)},i.config={end:{}},j.pt.callback=function(){this.openLayer();var f=this,e=this.layerE,n=this.config,m=n.dialog;this.config.success(e),i.iE6&&this.IE6(),e.find(".xubox_close").off("click").on("click",function(d){d.preventDefault(),n.close(f.index)}),e.find(".xubox_yes").off("click").on("click",function(d){d.preventDefault(),m.yes(f.index)}),e.find(".xubox_no").off("click").on("click",function(d){d.preventDefault(),m.no(f.index)}),this.layerS.off("click").on("click",function(d){d.preventDefault(),f.config.shadeClose&&layer.close(f.index)}),i.config.end[this.index]=n.end},j.pt.IE6=function(){var m,d=this,q=this.layerE,p=l("select"),o=d.dom,n=q.offset().top;m=this.config.fix?function(){q.css({top:l(document).scrollTop()+n})}:function(){q.css({top:n})},m(),k.scroll(m),l.each(p,function(){var e=l(this);e.parents("."+o.lay)[0]||"none"==e.css("display")||e.attr({layer:"1"}).hide()}),this.reselect=function(){l.each(p,function(){var e=l(this);e.parents("."+o.lay)[0]||1==e.attr("layer")&&l("."+o.lay).length<1&&e.removeAttr("layer").show()})}},j.pt.openLayer=function(){var e=this,d=e.dom;layer.index=i.times,layer.autoArea=function(f){return e.autoArea(f)},layer.getIndex=function(f){return l(f).parents("."+d.lay).attr("times")},layer.getChildFrame=function(f,m){return m=m||l("."+d.ifr).parents("."+d.lay).attr("times"),l("#"+d.lay+m).find("."+d.ifr).contents().find(f)},layer.getFrameIndex=function(f){return l(f?"#"+f:"."+d.ifr).parents("."+d.lay).attr("times")},layer.iframeAuto=function(m){var r,q,p,o,n;m=m||l("."+d.ifr).parents("."+d.lay).attr("times"),r=this.getChildFrame("body",m).outerHeight(),q=l("#"+d.lay+m),p=q.find(".xubox_title"),o=0,!p||(o=p.height()),q.css({height:r+o}),n=-parseInt(l("#xubox_border"+m).css("top")),l("#xubox_border"+m).css({height:r+2*n+o}),l("#"+d.ifr+m).css({height:r})},layer.close=function(o){var n,m=l("#"+d.lay+o),f=l("#xubox_moves, #xubox_shade"+o);if(m.attr("type")==e.type[1]){if(m.find(".xuboxPageHtml")[0]){m.remove()}else{for(m.find(".xubox_close,.xubox_botton,.xubox_title,.xubox_border").remove(),n=0;3>n;n++){m.find(".layer_pageContent").unwrap().hide()}}}else{document.all&&m.find("#"+d.ifr+o).remove(),m.remove()}f.remove(),i.iE6&&e.reselect(),"function"==typeof i.config.end[o]&&i.config.end[o](),delete i.config.end[o]},layer.loadClose=function(){var f=l(".xubox_loading").parents("."+d.lay),m=f.attr("times");layer.close(m)},layer.shift=function(t,s){var r,q=e.config,p=i.iE6,o=e.layerE,n=0,m=k.width(),f=k.height();switch(n="50%"==q.offset[1]||""==q.offset[1]?o.outerWidth()/2:o.outerWidth(),r={t:{top:q.border[0]},b:{top:f-o.outerHeight()-q.border[0]},cl:n+q.border[0],ct:-o.outerHeight(),cr:m-n-q.border[0],fn:function(){p&&e.IE6()}},t){case"left-top":o.css({left:r.cl,top:r.ct}).animate(r.t,s,r.fn);break;case"right-top":o.css({left:r.cr,top:r.ct}).animate(r.t,s,r.fn);break;case"left-bottom":o.css({left:r.cl,top:f}).animate(r.b,s,r.fn);break;case"right-bottom":o.css({left:r.cr,top:f}).animate(r.b,s,r.fn)}},layer.setMove=function(){return e.move()},layer.area=function(s,r){var q,p=[l("#"+d.lay+s),l("#xubox_border"+s)],o=p[0].attr("type"),n=p[0].find(".xubox_main"),m=p[0].find(".xubox_title");(o===e.type[1]||o===e.type[2])&&(p[0].css(r),p[1][0]&&p[1].css({width:r.width-2*parseInt(p[1].css("left")),height:r.height-2*parseInt(p[1].css("top"))}),n.css({height:r.height}),o===e.type[2]&&(q=p[0].find("iframe"),q.css({width:r.width,height:m?r.height-m.outerHeight():r.height})),"0px"!==p[0].css("margin-left")&&(r.hasOwnProperty("top")&&p[0].css({top:r.top-(p[1][0]&&parseInt(p[1].css("top")))}),r.hasOwnProperty("left")&&p[0].css({left:r.left+p[0].outerWidth()/2-(p[1][0]&&parseInt(p[1].css("left")))}),p[0].css({marginLeft:-p[0].outerWidth()/2})))},layer.closeAll=function(){var f=l("."+d.lay);l.each(f,function(){var m=l(this).attr("times");layer.close(m)})},layer.zIndex=e.config.zIndex,layer.setTop=function(f){return layer.zIndex=parseInt(f[0].style.zIndex),setZindex=function(){layer.zIndex++,f.css("z-index",layer.zIndex+1)},f.on("mousedown",setZindex),layer.zIndex}},i.run=function(){l=jQuery,k=l(h),this.load(),l.layer=function(e){var d=new j(e);return d.index}},"undefined"!=typeof a?c.exports=layer:h.layer=layer,i.run()}(window)});