define(function(require,exports,module){var e=require("appUtils"),t=require("validatorUtil"),i=require("serviceImp").getInstance(),n=require("layerUtils"),s=require("gconfig"),l=s.global;function r(t){var n="1";for(var s=0;s<9;s++){n+=parseInt(Math.random()*10)+""}var l="",r={rodam:n,userId:e.getSStorageInfo("user_id"),key:"stockDelegateTradeSys"};if(w()){var u=khmobile.createKey(JSON.stringify(r));if(""==u)o(t);else f(u)}else{require("shellPlugin").callShellMethod("createKeyPlugin",function(e){f(e.pkcs10)},function(){o(t)},r)}function f(n){l=n;var s={user_id:e.getSStorageInfo("user_id"),pkcs10:l};var r="zd";i.queryCompyCart(s,function(e){a(e,r,t)},false,true,function(){o(t)})}}function o(e){n.iConfirm("请求超时，是否重新加载？",function(){r(e)})}function a(t,i,s){var l=t.error_no;var r=t.error_info;if(l=="0"){var o={content:t.results[0].p7cert,userId:e.getSStorageInfo("user_id"),type:i};if(w()){var t=khmobile.initZs(JSON.stringify(o));if(t=="OK"){s()}}else{require("shellPlugin").callShellMethod("initZsPlugin",function(e){if(e=="OK"){try{s()}catch(e){console.log(e.message)}}},null,o)}}else{n.iLoading(false);n.iAlert(t.error_info,-1)}}function u(t,i,s,l,r){var o='<div class="pop_tip notice" id="utils_confirm"><span class="icon"></span><p>'+t+'</p><div class="btn"><a href="javascript:void(0);" id="utils_confirm_one">'+i+'</a><a href="javascript:void(0);" id="utils_confirm_two">'+s+"</a></div></div>";var a=n.layerCustom(o);e.preBindEvent($("#utils_confirm")," #utils_confirm_one",function(){if(l){l()}n.iCustomClose()});e.preBindEvent($("#utils_confirm")," #utils_confirm_two",function(){if(r){r()}n.iCustomClose()})}function f(e){var i=$(e).val(),n="",s="",l="";i=i.replace(/-/g,"/");if(t.isDate(i)){var r=new Date(i);n=r.getFullYear()+"";s=(r.getMonth()+1+"").length==1?"0"+(r.getMonth()+1):r.getMonth()+1+"";l=(r.getDate()+"").length==1?"0"+r.getDate():r.getDate()+""}var o={selector:$(e).attr("id"),year:n,month:s,day:l};if(n=="NaN"){o.year="";o.month="";o.day=""}require("shellPlugin").callShellMethod("calendarPlugin",null,null,o)}function g(t,i,n){var l=$(t).find("em").html();var r=l.replace(/\s+/g,"");var o="background-color:#FFFFFF; color:#000000; border:1px solid "+n+";line-height:35px;"+"font-size:20px;padding:0px 5px;font-weight:bold;";if(i==1){if(r.length>3&&r.length<=7){l=r.substring(0,3)+" "+r.substring(3,7)}else if(r.length>7&&r.length<=11){l=r.substring(0,3)+" "+r.substring(3,7)+" "+r.substring(7,11)}if(s.platform==0){o+="width:145px;"}else if(s.platform==1){o+="width:133px;"}else{o+="width:143px;"}}else if(i==2){if(r.length>4&&r.length<=8){l=r.substring(0,4)+" "+r.substring(4,8)}else if(r.length>8&&r.length<=12){l=r.substring(0,4)+" "+r.substring(4,8)+" "+r.substring(8,12)}else if(r.length>12&&r.length<=16){l=r.substring(0,4)+" "+r.substring(4,8)+" "+r.substring(8,12)+" "+r.substring(12,16)}else if(r.length>16&&r.length<=19){l=r.substring(0,4)+" "+r.substring(4,8)+" "+r.substring(8,12)+" "+r.substring(12,16)+" "+r.substring(16)}else if(r.length>19&&r.length<=21){l=r.substring(0,4)+" "+r.substring(4,8)+" "+r.substring(8,12)+" "+r.substring(12,16)+" "+r.substring(16,20)+" "+r.substring(20)}if(r.length<=16){if(s.platform==0){o+="width:212px;"}else if(s.platform==1){o+="width:188px;"}else{o+="width:198px;"}}else{if(s.platform==0){o+="width:253px;"}else if(s.platform==1){o+="width:225px;"}else{o+="width:235px;"}}}var a=$.layer({type:4,closeBtn:false,shade:false,shadeClose:false,fix:true,title:false,area:["auto","auto"],border:[10,.3,"#000",true],zIndex:19930902,tips:{msg:l,follow:t,guide:0,isGuide:true,style:[o,"#D83005"]}});var u=$(".xubox_tips").offset().left+$(".xubox_tips").width()-$(window).width();if(u>0){$(".xubox_tips").css("margin-left","-"+(u+10)+"px");$(".xubox_tips").find("i").css("margin-left",u+10+"px")}if(r==""&&a){layer.close(a)}e.bindEvent($(t),function(){if(a){layer.close(a)}},"blur")}function c(e,t){var i=$(e).val();if(i.length>t){$(e).val(i.substring(0,t))}}var d=null;function h(e,t){if(!t){if(d!=null){window.clearInterval(d);d=null}d=window.setInterval(function(){n.iLoading(false);e()},s.ajaxTimeout*1e3)}else{window.clearTimeout(d);d=null}}function p(e){if(w()){var t=khmobile.getPhoneNo();i(t)}else{require("shellPlugin").callShellMethod("getPhoneNoPlugin",function(e){i(e)},null,{})}function i(t){var i=/^[1-9]\d{10}$/;if(t==14){t=t.substring(3)}else if(!i.test(t)){$(e).val("");return}$(e).val(t);v(e)}}function v(e,t){var i=e.createTextRange();i.collapse(true);i.moveStart("character",t?t:e.value.length);i.select()}function b(e,t){$(t).val(e)}function m(){$("body").css("padding-bottom","0").scrollTop(0)}function x(){var e=$("body>div[type='tips']");if(e.length>0){e.remove()}}function w(){if(navigator.userAgent.indexOf("Android")>0)return true;else return false}function y(e){var t="";$.each(e,function(e,i){t+=e+"="+i+"&"});t=t.substring(0,t.length-1);console.log("urlParams："+t);return t}function _(){if(navigator.userAgent.indexOf("Android")>0){khmobile.closeApp()}if(/\((iPhone|iPad|iPod)/i.test(navigator.userAgent)){window.location.href="backClientSide"}}function P(){var t=(new Date).getTime();i.serviceAjax("/commons/getIp",null,function(i){var n=(new Date).getTime();console.log("获取IP,Mac耗时:"+(n-t)+"毫秒");var s=i.status;var l="192.168.1.109";var r="02:00:5E:00:00:14";if(s=="000000"){l=i.data.ip;r=i.data.mac}e.setSStorageInfo("ip",l);e.setSStorageInfo("mac",r)})}var S={installCertificate:r,layerTwoButton:u,selectDate:f,showBigNo:g,dealIPhoneMaxLength:c,setCursorPosition:v,getPhoneNo:p,getInput:b,onFinish:m,closeBigNoTips:x,jsonToParams:y,isAndroid:w,closeApp:_,getIp:P};module.exports=S});