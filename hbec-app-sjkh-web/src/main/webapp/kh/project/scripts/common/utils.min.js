define(function(j,A,d){var c=j("appUtils"),m=j("validatorUtil"),B=j("serviceImp").getInstance(),v=j("layerUtils"),h=j("gconfig"),o=h.global;function b(I){var G="1";for(var D=0;D<9;D++){G+=parseInt(Math.random()*10)+""}var C="",H={rodam:G,userId:c.getSStorageInfo("user_id"),key:"stockDelegateTradeSys"};if(w()){var E=khmobile.createKey(JSON.stringify(H));if(""==E){a(I)}else{F(E)}}else{j("shellPlugin").callShellMethod("createKeyPlugin",function(J){F(J.pkcs10)},function(){a(I)},H)}function F(K){C=K;var L={user_id:c.getSStorageInfo("user_id"),pkcs10:C};var J="zd";B.queryCompyCart(L,function(M){l(M,J,I)},false,true,function(){a(I)})}}function a(C){v.iConfirm("请求超时，是否重新加载？",function(){b(C)})}function l(F,E,H){var D=F.error_no;var C=F.error_info;if(D=="0"){var G={content:F.results[0].p7cert,userId:c.getSStorageInfo("user_id"),type:E};if(w()){var F=khmobile.initZs(JSON.stringify(G));if(F=="OK"){H()}}else{j("shellPlugin").callShellMethod("initZsPlugin",function(I){if(I=="OK"){try{H()}catch(J){console.log(J.message)}}},null,G)}}else{v.iLoading(false);v.iAlert(F.error_info,-1)}}function u(I,D,C,H,G){var F='<div class="pop_tip notice" id="utils_confirm"><span class="icon"></span><p>'+I+'</p><div class="btn"><a href="javascript:void(0);" id="utils_confirm_one">'+D+'</a><a href="javascript:void(0);" id="utils_confirm_two">'+C+"</a></div></div>";var E=v.layerCustom(F);c.preBindEvent($("#utils_confirm")," #utils_confirm_one",function(){if(H){H()}v.iCustomClose()});c.preBindEvent($("#utils_confirm")," #utils_confirm_two",function(){if(G){G()}v.iCustomClose()})}function i(H){var E=$(H).val(),D="",G="",C="";E=E.replace(/-/g,"/");if(m.isDate(E)){var F=new Date(E);D=F.getFullYear()+"";G=(F.getMonth()+1+"").length==1?"0"+(F.getMonth()+1):(F.getMonth()+1)+"";C=(F.getDate()+"").length==1?"0"+F.getDate():F.getDate()+""}var I={selector:$(H).attr("id"),year:D,month:G,day:C};if(D=="NaN"){I.year="";I.month="";I.day=""}j("shellPlugin").callShellMethod("calendarPlugin",null,null,I)}function p(I,F,E){var H=$(I).find("em").html();var C=H.replace(/\s+/g,"");var J="background-color:#FFFFFF; color:#000000; border:1px solid "+E+";line-height:35px;font-size:20px;padding:0px 5px;font-weight:bold;";if(F==1){if(C.length>3&&C.length<=7){H=C.substring(0,3)+" "+C.substring(3,7)}else{if(C.length>7&&C.length<=11){H=C.substring(0,3)+" "+C.substring(3,7)+" "+C.substring(7,11)}}if(h.platform==0){J+="width:145px;"}else{if(h.platform==1){J+="width:133px;"}else{J+="width:143px;"}}}else{if(F==2){if(C.length>4&&C.length<=8){H=C.substring(0,4)+" "+C.substring(4,8)}else{if(C.length>8&&C.length<=12){H=C.substring(0,4)+" "+C.substring(4,8)+" "+C.substring(8,12)}else{if(C.length>12&&C.length<=16){H=C.substring(0,4)+" "+C.substring(4,8)+" "+C.substring(8,12)+" "+C.substring(12,16)}else{if(C.length>16&&C.length<=19){H=C.substring(0,4)+" "+C.substring(4,8)+" "+C.substring(8,12)+" "+C.substring(12,16)+" "+C.substring(16)}else{if(C.length>19&&C.length<=21){H=C.substring(0,4)+" "+C.substring(4,8)+" "+C.substring(8,12)+" "+C.substring(12,16)+" "+C.substring(16,20)+" "+C.substring(20)}}}}}if(C.length<=16){if(h.platform==0){J+="width:212px;"}else{if(h.platform==1){J+="width:188px;"}else{J+="width:198px;"}}}else{if(h.platform==0){J+="width:253px;"}else{if(h.platform==1){J+="width:225px;"}else{J+="width:235px;"}}}}}var G=$.layer({type:4,closeBtn:false,shade:false,shadeClose:false,fix:true,title:false,area:["auto","auto"],border:[10,0.3,"#000",true],zIndex:19930902,tips:{msg:H,follow:I,guide:0,isGuide:true,style:[J,"#D83005"]}});var D=($(".xubox_tips").offset().left+$(".xubox_tips").width())-$(window).width();if(D>0){$(".xubox_tips").css("margin-left","-"+(D+10)+"px");$(".xubox_tips").find("i").css("margin-left",(D+10)+"px")}if(C==""&&G){layer.close(G)}c.bindEvent($(I),function(){if(G){layer.close(G)}},"blur")}function k(E,C){var D=$(E).val();if(D.length>C){$(E).val(D.substring(0,C))}}var q=null;function f(D,C){if(!C){if(q!=null){window.clearInterval(q);q=null}q=window.setInterval(function(){v.iLoading(false);D()},h.ajaxTimeout*1000)}else{window.clearTimeout(q);q=null}}function e(D){if(w()){var C=khmobile.getPhoneNo();E(C)}else{j("shellPlugin").callShellMethod("getPhoneNoPlugin",function(F){E(F)},null,{})}function E(F){var G=/^[1-9]\d{10}$/;if(F==14){F=F.substring(3)}else{if(!G.test(F)){$(D).val("");return}}$(D).val(F);s(D)}}function s(D,C){var E=D.createTextRange();E.collapse(true);E.moveStart("character",C?C:D.value.length);E.select()}function y(D,C){$(C).val(D)}function x(){$("body").css("padding-bottom","0").scrollTop(0)}function z(){var C=$("body>div[type='tips']");if(C.length>0){C.remove()}}function w(){if(navigator.userAgent.indexOf("Android")>0){return true}else{return false}}function n(D){var C="";$.each(D,function(E,F){C+=E+"="+F+"&"});C=C.substring(0,C.length-1);console.log("urlParams："+C);return C}function r(){if(navigator.userAgent.indexOf("Android")>0){khmobile.closeApp()}if(/\((iPhone|iPad|iPod)/i.test(navigator.userAgent)){window.location.href="backClientSide"}}function g(){var C=new Date().getTime();var E={step:"getIp"};if(w()){var D=khmobile.requestUrlParamsEncoding(t.jsonToParams(E));F(D)}else{j("shellPlugin").callShellMethod("toukerServerPlugin",function(G){F(G)},function(G){},{command:"requestUrlParamsEncoding",params:t.jsonToParams(E)})}function F(G){B.hbAjax(G,function(I){var H=new Date().getTime();console.log("获取IP,Mac耗时:"+(H-C)+"毫秒");c.setSStorageInfo("ip",I.results.dataSet.ip);c.setSStorageInfo("mac",I.results.dataSet.mac)})}}var t={installCertificate:b,layerTwoButton:u,selectDate:i,showBigNo:p,dealIPhoneMaxLength:k,setCursorPosition:s,getPhoneNo:e,getInput:y,onFinish:x,closeBigNoTips:z,jsonToParams:n,isAndroid:w,closeApp:r,getIp:g};d.exports=t});